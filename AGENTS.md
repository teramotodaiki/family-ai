# Family AI プロジェクト コーディング指針

## 目的

家族が日常で安全に使える AI アプリを提供する。幼児と保護者の利用を前提に、誤操作と過度な複雑さを排除する。実機で安定動作する最小機能を継続的に積み上げる。

## 非目標

機能の大量実装を優先しない。未検証の依存を増やさない。抽象化のやり過ぎをしない。複数プラットフォーム同時最適化を狙わない。

## 技術方針

- Expo Managed Workflow を採用する。
- iOS を主対象に検証する。
- TypeScript を厳格設定で使用する。
- 画面遷移は Expo Router v3 を使用する。
- グローバル状態管理は初期段階で導入しない。必要になった時点で最小限のストアを追加する。選定は Jotai を第一候補に固定する。
- UI ライブラリは導入しない。標準コンポーネントと StyleSheet を使用する。
- 通信は fetch を使用する。共通ラッパーを shared/lib/request.ts として定義する。
- 永続化は expo-secure-store を使用する。機微情報のみを保存する。
- 依存追加は PR で理由と代替案の比較根拠を明記する。

## ディレクトリ構成（モバイル）

# Monorepo（メインアプリ／子どもアプリ 分割）

```
apps/
  main/
  kids/
packages/
  ui/
  i18n/
  ...
```

## コーディング規約

- 関数コンポーネントのみを使用する。クラスコンポーネントは使用しない。
- useEffect で副作用をまとめない。副作用は用途ごとに分割する。
- 非同期は async/await を使用する。Promise.then チェーンは使用しない。
- 例外は上位に伝播させない。ハンドラで握り、ユーザーに明確な文言で通知する。
- 文言は packages/i18n に集約する。ハードコードを禁止する。
- スタイルは StyleSheet.create を使用する。インラインスタイルの乱用を禁止する。
- 型は明示する。any の使用を禁止する。
- ファイル名はケバブケース、コンポーネントはパスカルケースに統一する。

## エラーハンドリング規約

- ネットワークエラーは再試行可能な文言でトースト表示する。
- 致命的な例外はエラースクリーンに遷移する。
- ログには個人情報を含めない。端末情報の送信を禁止する。

## アクセシビリティ規約

- タップ領域は最小 44x44pt を確保する。
- 文字サイズは OS のアクセシビリティ設定に追従させる。
- 音声フィードバックはユーザー操作の完了時に限定する。

## パフォーマンス規約

- 画面単位でコード分割を行う。重い初期化処理をトップ画面に置かない。
- 画像は必要サイズで取り込む。Base64 埋め込みを禁止する。

## テスト方針

- 初期段階では自動テストを追加しない。実機での動作確認を最優先にする。
- ロジックが安定した時点でユニットテストを段階的に追加する。

## セキュリティ方針

- 認証情報とシークレットをリポジトリに含めない。env ファイルのコミットを禁止する。
- クリップボード操作を安易に行わない。ユーザー操作の明示がある場合のみ実行する。

## AI 実装オペレーション

- 1PR の変更は小さく保つ。ファイル数は 10 以下、差分は 300 行以下に抑える。
- 変更提案時に作業計画を 5 行以内で先に提示する。
- その後に完全なファイル単位のコードを提示する。差分の省略を禁止する。
- 出力順序を固定する。

  1. 作業計画
  2. 追加/変更ファイル一覧
  3. 各ファイルの完全な内容（パスをコメントで先頭に記し、コードを続ける）
  4. 実行手順

- ファイルパスの先頭は monorepo ルートからの相対で記述する。
- 依存追加時は package.json の変更とインストール手順を必ず含める。

## 最初のスキャフォールド要件

- Expo Router を有効化し、`app/_layout.tsx` と `app/index.tsx` を定義する。
- 共通ボタンコンポーネントを `shared/ui/Button.tsx` に定義する。
- リクエストラッパーを `shared/lib/request.ts` に定義する。
- 文言辞書を `packages/i18n/ja.ts` に定義し、画面から参照する。

## 実装品質チェックリスト

- 型エラーがゼロである。
- ESLint と Prettier が通過する。
- iOS 実機と iOS シミュレータで起動し、トップ画面が 1 秒以内に表示される。
- 新規依存が導入された場合、根拠を PR に記述する。

## PR テンプレート（AI 出力用）

```

# 目的

# 変更点

# 動作確認手順

# リスクとリリース計画

```

## コミット規約（Conventional Commits）

- feat: 新機能
- fix: バグ修正
- chore: 雑務
- docs: ドキュメント
- refactor: リファクタ
- test: テスト

## キックオフ・プロンプト（AI 用）

次の要件に従って、最小スキャフォールドを実装する。変更は小さく、完全なファイルを提示する。差分の省略をしない。実行手順を含める。

- Expo Router 有効化
- トップ画面の文言表示
- 共通ボタンの作成
- 文言辞書の導入
- リクエストラッパーの作成

```

```
